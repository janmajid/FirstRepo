<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Premier League Standings </title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>

    <h1>âš½ Premier League 2023 Standings</h1>

<script>
const API_ENDPOINT = 'https://www.7timer.info/bin/api.pl?lon=113.17&lat=23.09&product=astro&output=xml';
const container = document.getElementById('data-container');
const TIMEOUT_MS = 30000; // 2 minutes in milliseconds

async function fetchDataWithTimeout() {
    // 1. Create a new AbortController instance
    const controller = new AbortController();
    const signal = controller.signal;

    // 2. Start a timer. If it completes before the fetch, it calls controller.abort()
    const timeoutId = setTimeout(() => {
        document.write("timer set");
        'controller.abort();
        document.write("set complete");
    }, TIMEOUT_MS);

    try {
        container.textContent = `Fetching data (timeout set to ${TIMEOUT_MS / 1000} seconds)...`;
        
        // 3. Pass the signal object to the fetch call
        document.write("Starting");
        const response = await fetch(API_ENDPOINT, { signal });
        document.write("Completed");
        // IMPORTANT: Clear the timeout if the fetch succeeds before the timer ends
        clearTimeout(timeoutId);

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const xmlText = await response.text();
        container.textContent = xmlText;

    } catch (error) {
        // 4. Check if the error was caused by the timeout
        if (error.name === 'AbortError') {
            container.textContent = 'ðŸ›‘ Request Timed Out (took longer than 2 minutes).';
            console.error('Fetch Aborted:', 'The request was manually aborted by the timeout timer.');
        } else {
            // Handle other errors (network issues, API server errors, etc.)
            container.textContent = `ðŸ”´ Failed to load data. Error: ${error.message}`;
            console.error('Error fetching data:', error);
        }
    }
}

fetchDataWithTimeout();
</script>
</body>
</html>
